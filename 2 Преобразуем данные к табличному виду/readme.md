# Создание нового проекта. Преобразование данных к табличному виду

#### Загрузить данные Объем внутридневных кредитов Банка России до текущего дня:

1. Находим [сайт](https://www.cbr.ru/hd_base/dv/?UniDbQuery.Posted=True&UniDbQuery.From=29.06.2007&UniDbQuery.To=27.11.2023&UniDbQuery.P1=1)
2. Создать источник -> Интернет
3. Указываем адресс сайта и нажимаем ОК
4. Предлагаемые таблицы -> выбираем нужную с необходимыми данными
5. Даем название для запроса таблицы - Объем внутридневных кредитов Банка России
6. Меняем название колонки Всего на Сумма, млрд. руб.

Требуется создать еще одну таблицу Каленьдар дат

[Power_BI_calendar]https://powerbi.tips/2017/11/creating-a-dax-calendar/

Копируем формулу
```
Dates  = 
  GENERATE ( 
    CALENDAR ( DATE ( 2017, 1, 1 ), DATE ( 2017, 12, 31 ) ), 
    VAR currentDay = [Date]
    VAR day = DAY( currentDay )
    VAR month =  MONTH ( currentDay ) 
    VAR year =  YEAR ( currentDay )
  RETURN   ROW ( 
    "day", day, 
    "month", month, 
    "year", year )
  )
```
В меню выбираем Моделирование и жмем Создать таблицу
Вставляем указанный код и нажимаем ENTER
```
Календарь = 
  GENERATE ( 
    CALENDAR ( MIN ( 'Объем внутридневных кредитов Банка России'[Дата]), TODAY() ), 
    VAR currentDay = [Date]
    VAR day = DAY( currentDay )
    VAR month =  MONTH ( currentDay ) 
    VAR year =  YEAR ( currentDay )
  RETURN   ROW ( 
    "day", day, 
    "month", month, 
    "year", year )
  )
```
<em>*Если выходит ошибка, то меняем , на ;</em>

- Нужно установить связь между таблицами
- В Представление модели нужно связать поля Дата в обеих таблицах 
- Жмем на любое из них и перетягиваем на второе у нас создалась связь между таблицами

Создадим отчет

- Выбираем график Гистограм с накоплением 
- Выбираем ось Х берем Год
- Выбираем значения - Сумма выданных кредитов

Чтобы посмотреть не только по годам но также по месяцам и дням нужно сделать иерархию
- Перетаскиваем Year на Day создалось иерархия, сюда же перетягиваем Месяц
- Потом переставляем так пусть первым идет Год, Месяц, День
- Ось Х отчета меняем на иерархию 
- Появились стрелки чтобы посмотреть детали. Например можно выбрать вторую стрелку и какой-нибудь год и увидеть данные по меяцам объем кредита этого года
- Месяцы отсортированны не по номеру месяца, а по обьему кредита. 
- Выбираем три точки сверху отчета (Дополнительные параметры)  - Выбираем сортировка Year Month - Сортировать по возрастанию
- Стрелкой вверх можем подняться на верх
- Если нажать стрелку с разветвлением то он откроет сразу в одном окне все года и месяцы

Добавляем Фильтр

Выбираем Элемент Срез
В поле перетягиваем Год

Конечный результат [лаб2]()

Преобразуем и создаем отчет таблицы Домашнее задание _Продажи по магазинам_.xlsx

- Приводим данные к табличному виде, проверям тип и значения колонок
- Таблицы должны быть в столбцах, если нужно траспонируем
- Проверяем название столбцов
- Убираем пустые строки и столбцы
- В обьединеных ячейках нужно заполнить пустые ячейки

Преоброзвания к табличному виду в PowerQuery

- Сократить строки - Удалить пустые строки
- Если название колонок в первой строке нажимаем - Использовать Первую строку в качестве заголовка 
- Управление столбцами - Выбор столбцов - Выбираем нужные нам колонки
- Если тип не указан или неправильный - выбираем Тип данных - выбираем нужный
- Выбираем столбец с разными типами для десятичного числа. Выбираем тип данных как текст. Замена значений . на , Потом выбираем тип данных десятичное число
- Перобразование - Замена ошибки на 0

Как заполнить обьединеные строки
- Выбираем столбец - Преобразование - FILL (со стрелкой вниз) - вниз
- Хотим оставить данные до разделителя - Выбираем колнку - Нажимаем в меню Добавление столбца - Извлечь - Текст перед разделителем - пишем -
- Можно разделить текст в столбце - Преобразование - Столбец "Текст" - По разделителю - Пользовательский - Запятая и пробел - ОК
- Переименуем колонку

Для повторяющих значений можно создать отдельную таблицу

- Главная страница - Управление - Дублирование - Создалось точно такое же таблица
- Переименуем Города
- Удаляем ненужные столбцы
- Сократить строки - Удалить строки - Удалить дубликаты


 Домашнее задание _Продажи по магазинам_.xlsx 

 ### Преобразуем стобцы как данные из трех листов: Продажи (Не "Продажи звезда"), Магазин, Товар
1. Удалить пустые строки и столбцы.
2. Сделать первую строку заголовками.
3. В колонке “Цена продажи за шт.” оставить только числовые значения (удалить “ шт”)
4. Переименовать колонку в “Цена продажи за шт., руб.”
5. Заменить в колонке “Вес, кг” точку на запятую.
6. Проставить типы данных и каждой колонки: число, дата или текст.
7. В поле “Магазин” заполнить значения.
8. Создать отдельную таблицу по магазинам с полями: "Магазин", "Адрес", "Площадь, м2", "Количество сотрудников", "ID Магазина"
9. Создать отдельную таблицу по товарам с полями: "Товар", "Вес, кг", "Категория", "ID товара"
10. В таблице продажи оставить колонки: "ID Магазина", "ID товара", "Дата", "Цена продажи за шт.", "Продано шт."

Конечный результат [лаб2.1]()
